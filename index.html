<!DOCTYPE html>
<html>
<head>
  <title>ATS Resume Score Checker</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
  <style>
    #resume-upload, #job-description, #score-container {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container my-5">
    <h1 class="mb-4 text-center">ATS Resume Score Checker</h1>
    <div class="alert alert-warning" id="alert" role="alert" style="display: none;"></div>
    <div id="resume-upload">
      <label for="resume-file" class="form-label">Upload Resume:</label>
      <input type="file" id="resume-file" class="form-control" accept=".pdf" required>
    </div>
    <div id="job-description">
      <label for="job-desc" class="form-label">Enter Job Description:</label>
      <textarea id="job-desc" class="form-control" rows="5" required></textarea>
    </div>
    <div class="d-grid">
      <button id="check-score" class="btn btn-primary btn-lg mb-3">Check Score</button>
    </div>
    <div id="score-container" style="display: none;">
      <h2 class="mb-3">Resume Score:</h2>
      <p id="score-display" class="lead">0</p>
      <button id="print-report" class="btn btn-secondary">Print Report</button>
    </div>
  </div>

  <!-- PDF.js Library -->
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

  <!-- Natural Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/natural/1.0.0/natural.min.js"></script>

  <!-- html2pdf.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    const resumeFileInput = document.getElementById('resume-file');
    const jobDescriptionInput = document.getElementById('job-desc');
    const checkScoreButton = document.getElementById('check-score');
    const scoreDisplay = document.getElementById('score-display');
    const printReportButton = document.getElementById('print-report');
    const scoreContainer = document.getElementById('score-container');
    const alertContainer = document.getElementById('alert');

    checkScoreButton.addEventListener('click', () => {
      if (resumeFileInput.files.length === 0 || jobDescriptionInput.value.trim() === '') {
        showAlert('Please upload a resume and enter a job description.', 'danger');
        return;
      }

      const file = resumeFileInput.files[0];
      if (file && file.type === 'application/pdf') {
        const fileReader = new FileReader();
        fileReader.onload = () => {
          pdfjsLib.getDocument(fileReader.result).promise.then((pdf) => {
            let resumeContent = '';
            for (let i = 1; i <= pdf.numPages; i++) {
              pdf.getPage(i).then((page) => {
                page.getTextContent().then((textContent) => {
                  const textItems = textContent.items;
                  for (let j = 0; j < textItems.length; j++) {
                    resumeContent += textItems[j].str + ' ';
                  }
                  if (i === pdf.numPages) {
                    const score = calculateResumeScore(resumeContent, jobDescriptionInput.value);
                    scoreDisplay.textContent = score;
                    scoreContainer.style.display = 'block';
                    showAlert(`Resume score: ${score}%`, 'success');
                  }
                });
              });
            }
          }).catch((error) => {
            showAlert('Error processing the resume file.', 'danger');
            console.error('Error:', error);
          });
        };
        fileReader.readAsDataURL(file);
      } else {
        showAlert('Please upload a PDF file.', 'danger');
      }
    });

    printReportButton.addEventListener('click', () => {
      const element = document.getElementById('score-container');
      const opt = {
        margin: 1,
        filename: 'resume-score-report.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    });

    function calculateResumeScore(resumeContent, jobDescription) {
      const tokenizer = new natural.WordTokenizer();
      const resumeTokens = tokenizer.tokenize(resumeContent.toLowerCase());
      const jobDescriptionTokens = tokenizer.tokenize(jobDescription.toLowerCase());

      const resumeTermFrequency = calculateTermFrequency(resumeTokens);
      const jobDescriptionTermFrequency = calculateTermFrequency(jobDescriptionTokens);

      let score = 0;
      for (const term of Object.keys(jobDescriptionTermFrequency)) {
        if (resumeTermFrequency[term]) {
          score += resumeTermFrequency[term] * jobDescriptionTermFrequency[term];
        }
      }

      return Math.round((score / Object.keys(jobDescriptionTermFrequency).length) * 100);
    }

    function calculateTermFrequency(tokens) {
      const termFrequency = {};
      for (const token of tokens) {
        termFrequency[token] = termFrequency[token] ? termFrequency[token] + 1 : 1;
      }
      return termFrequency;
    }

    function showAlert(message, type) {
      alertContainer.textContent = message;
      alertContainer.classList.remove('alert-warning', 'alert-danger', 'alert-success');
      alertContainer.classList.add(`alert-${type}`);
      alertContainer.style.display = 'block';
      setTimeout(() => {
        alertContainer.style.display = 'none';
      }, 5000);
    }
  </script>
</body>
</html>
